<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="TGB Builds"/>
  <meta name="theme-color" content="#1F2A37"/>
  <title>Tall Guy Builds</title>
  <link rel="manifest" href="/manifest.json"/>
  <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAIAAAC2BqGFAAABCGlDQ1BJQ0MgUHJvZmlsZQAAeJxjYGA8wQAELAYMDLl5JUVB7k4KEZFRCuwPGBiBEAwSk4sLGHADoKpv1yBqL+viUYcLcKakFicD6Q9ArFIEtBxopAiQLZIOYWuA2EkQtg2IXV5SUAJkB4DYRSFBzkB2CpCtkY7ETkJiJxcUgdT3ANk2uTmlyQh3M/Ck5oUGA2kOIJZhKGYIYnBncAL5H6IkfxEDg8VXBgbmCQixpJkMDNtbGRgkbiHEVBYwMPC3MDBsO48QQ4RJQWJRIliIBYiZ0tIYGD4tZ2DgjWRgEL7AwMAVDQsIHG5TALvNnSEfCNMZchhSgSKeDHkMyQx6QJYRgwGDIYMZAKbWPz9HbOBQAABMqElEQVR42pV9d5gcxfF2VfXMbL6clHNEEUmIIAuEDEJkbMBgwIAJxgRjjDFgzA9swIANOAAmGJtok3MGiSgUQSjnLJ1Ol+82T+iu749NM7t7wt89PLDszs7O1FRXV731VhVC0xTw/REvikqJEFn5mN5jSuMXFYBZt9ym6K9fqkK3bFpAJCKf8KoRJM6h3UBiHmLmYMcmb2C7FdTKGQHUPV5r5xQ+yZkuO4lSz93B3VpxnH2cnnf+P5r5AEVZMWb/pX2p2t/3Cb+1h5bQIahBFJPcXkE9MjzNMlBRqGxAiJhAIwgIbTkHpvZQwNh4cLmV+xhNqVJvVNHnc6cBjCqhqsGk8HFpR3GOLFarECBv9TolV5jHl9NiBUwCRNlHSy0GKTBrb3PesBjBfYXh8pT5AiIZMNIMBJJLbNERiOjUBBX4lK1YYaVUVHjaMWz2lOdRc6d5c"/>
  <style>
    *{-webkit-tap-highlight-color:transparent;box-sizing:border-box;}
    html,body{margin:0;padding:0;background:#16212E;height:100%;overscroll-behavior:none;}
    #root{height:100%;}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel" data-presets="react">
const { useState, useRef, useEffect } = React;
const C={navy:"#1F2A37",navyLight:"#2C3E50",gold:"#C8A96A",muted:"#6B7280",border:"#2E3D4F",warn:"#F59E0B",danger:"#EF4444",white:"#FFFFFF",bg:"#16212E",success:"#4CAF50"};
const font="'Georgia',serif";
const fb="system-ui,-apple-system,sans-serif";
const fmt$=v=>`$${Number(v).toLocaleString()}`;
const fmtDate=d=>d?new Date(d+"T12:00:00").toLocaleDateString("en-CA",{month:"short",day:"numeric",year:"numeric"}):"‚Äî";
const todayStr=()=>new Date().toISOString().slice(0,10);
const WEATHER=["‚òÄÔ∏è Sunny","‚õÖ Partly Cloudy","‚òÅÔ∏è Overcast","üåßÔ∏è Rain","‚ùÑÔ∏è Snow","üå®Ô∏è Blowing Snow","üå¨Ô∏è Windy","üå°Ô∏è Extreme Cold"];
const LOGO="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAIAAAC2BqGFAAABCGlDQ1BJQ0MgUHJvZmlsZQAAeJxjYGA8wQAELAYMDLl5JUVB7k4KEZFRCuwPGBiBEAwSk4sLGHADoKpv1yBqL+viUYcLcKakFicD6Q9ArFIEtBxopAiQLZIOYWuA2EkQtg2IXV5SUAJkB4DYRSFBzkB2CpCtkY7ETkJiJxcUgdT3ANk2uTmlyQh3M/Ck5oUGA2kOIJZhKGYIYnBncAL5H6IkfxEDg8VXBgbmCQixpJkMDNtbGRgkbiHEVBYwMPC3MDBsO48QQ4RJQWJRIliIBYiZ0tIYGD4tZ2DgjWRgEL7AwMAVDQsIHG5TALvNnSEfCNMZchhSgSKeDHkMyQx6QJYRgwGDIYMZAKbWPz9HbOBQAABMqElEQVR42pV9d5gcxfF2VfXMbL6clHNEEUmIIAuEDEJkbMBgwIAJxgRjjDFgzA9swIANOAAmGJtok3MGiSgUQSjnLJ1Ol+82T+iu749NM7t7wt89PLDszs7O1FRXV731VhVC0xTw";
const initClients=[{id:1,name:"Priya Sharma",phone:"306-555-0420",email:"priya@example.com",notes:"Referred by Mike T."},{id:2,name:"Dave Kowalski",phone:"306-555-0771",email:"dave@example.com",notes:"Seen 3 other builders"},{id:3,name:"Brian Wilson",phone:"306-555-0199",email:"brian@example.com",notes:"Long-time client"}];
const initJobs=[{id:1,name:"Addison Basement Dev",clientId:1,address:"3518 Green Creek Rd",type:"Basement Development",status:"Active",value:12000,paid:6000,startDate:"2026-02-03",endDate:"2026-04-15",progress:35,notes:"Framing phase underway",sharedWithClient:true,milestones:[{id:1,name:"Demo & Prep",status:"Completed",date:"2026-02-10",order:0},{id:2,name:"Framing",status:"In Progress",date:"2026-02-24",order:1},{id:3,name:"Electrical Rough-in",status:"Not Started",date:"2026-03-05",order:2},{id:4,name:"Plumbing Rough-in",status:"Not Started",date:"2026-03-10",order:3},{id:5,name:"Insulation & Drywall",status:"Not Started",date:"2026-03-20",order:4},{id:6,name:"Finishing & Paint",status:"Not Started",date:"2026-04-05",order:5},{id:7,name:"Final Inspection",status:"Not Started",date:"2026-04-15",order:6}],docs:[{name:"Approved Estimate.pdf",size:"142 KB",date:"2026-01-15"},{name:"Signed Contract.pdf",size:"88 KB",date:"2026-01-20"}]},
{id:2,name:"Kowalski Garage",clientId:2,address:"742 Henderson Dr",type:"Garage",status:"Upcoming",value:32000,paid:9600,startDate:"2026-04-20",endDate:"2026-06-30",progress:0,notes:"Permit submitted",sharedWithClient:true,milestones:[{id:1,name:"Permit Approval",status:"In Progress",date:"2026-04-10",order:0},{id:2,name:"Site Prep & Foundation",status:"Not Started",date:"2026-04-20",order:1},{id:3,name:"Framing",status:"Not Started",date:"2026-05-05",order:2},{id:4,name:"Roofing",status:"Not Started",date:"2026-05-20",order:3},{id:5,name:"Electrical & Doors",status:"Not Started",date:"2026-06-10",order:4},{id:6,name:"Finishing",status:"Not Started",date:"2026-06-25",order:5}],docs:[{name:"Approved Estimate.pdf",size:"98 KB",date:"2026-02-01"}]},
{id:3,name:"Wilson Deck Replacement",clientId:3,address:"88 Lakeview Cres",type:"Deck",status:"Completed",value:14200,paid:14200,startDate:"2025-09-01",endDate:"2025-10-10",progress:100,notes:"Holdback released",sharedWithClient:true,milestones:[{id:1,name:"Demo Old Deck",status:"Completed",date:"2025-09-03",order:0},{id:2,name:"New Posts & Framing",status:"Completed",date:"2025-09-15",order:1},{id:3,name:"Decking & Rails",status:"Completed",date:"2025-09-28",order:2},{id:4,name:"Stairs & Finishing",status:"Completed",date:"2025-10-08",order:3}],docs:[]},{id:4,name:"Sharma Deck Addition",clientId:1,address:"3518 Green Creek Rd",type:"Deck",status:"Upcoming",value:8500,paid:0,startDate:"2026-05-01",endDate:"2026-05-25",progress:0,notes:"Adding deck off main floor",sharedWithClient:false,milestones:[{id:1,name:"Material Order",status:"Not Started",date:"2026-04-20",order:0},{id:2,name:"Footings",status:"Not Started",date:"2026-05-01",order:1},{id:3,name:"Framing & Decking",status:"Not Started",date:"2026-05-10",order:2},{id:4,name:"Rails & Stairs",status:"Not Started",date:"2026-05-22",order:3}],docs:[]}];
const initLeads=[{id:1,name:"Mike Thornton",phone:"306-555-0192",email:"mike@example.com",type:"Deck",value:18500,stage:"New",notes:"Referred by Sarah H.",date:"2026-02-15"},{id:2,name:"Carla Jensen",phone:"306-555-0344",email:"carla@example.com",type:"Basement",value:45000,stage:"Quoted",notes:"Looking to start April",date:"2026-02-10"},{id:3,name:"Dave Kowalski",phone:"306-555-0771",email:"dave@example.com",type:"Garage",value:32000,stage:"Won",notes:"Signed contract",date:"2026-02-08"},{id:4,name:"Priya Sharma",phone:"306-555-0420",email:"priya@example.com",type:"Bathroom",value:12000,stage:"Won",notes:"Start Mar 3",date:"2026-01-28"}];
const initSubs=[{id:1,name:"Rick Paulson",trade:"Electrical",phone:"306-555-0811",email:"rick@paulsonelectric.ca",rating:5,notes:"Go-to for all electrical",active:true},{id:2,name:"Torres Plumbing",trade:"Plumbing",phone:"306-555-0234",email:"info@torresplumbing.ca",rating:4,notes:"Good but books up fast",active:true},{id:3,name:"Flatland Concrete",trade:"Concrete",phone:"306-555-0567",email:"jobs@flatland.ca",rating:5,notes:"Best prices in the city",active:true},{id:4,name:"Kyle Drywall",trade:"Drywall",phone:"306-555-0399",email:"kyle@kyledrywall.com",rating:3,notes:"Inconsistent finish quality",active:false}];
const initEvents=[{id:1,title:"Addison ‚Äì Framing Inspection",jobId:1,date:"2026-02-24",time:"10:00",type:"inspection"},{id:2,title:"Kowalski ‚Äì Site Measure",jobId:2,date:"2026-02-26",time:"14:00",type:"site"},{id:3,title:"Thornton ‚Äì Quote Walkthrough",jobId:null,date:"2026-02-28",time:"11:00",type:"quote"},{id:4,title:"Rick ‚Äì Electrical Rough-in",jobId:1,date:"2026-03-05",time:"08:00",type:"sub"},{id:5,title:"Kowalski Garage Start",jobId:2,date:"2026-04-20",time:"08:00",type:"site"}];
const initLogs=[{id:1,jobId:1,date:"2026-02-20",weather:"‚òÄÔ∏è Sunny",crew:3,hours:8,notes:"Completed interior framing on north and east walls. Started blocking for electrical. All plumb and square.",visibleToClient:true,photos:[]},{id:2,jobId:1,date:"2026-02-21",weather:"‚ùÑÔ∏è Snow",crew:2,hours:6,notes:"Snow slowed material delivery. Continued framing south wall. Crew of 2 due to weather.",visibleToClient:false,photos:[]}];
const initChangeOrders=[{id:1,jobId:1,title:"Additional pot lights in rec room",amount:850,status:"Approved",dateRequested:"2026-02-15",dateApproved:"2026-02-16",notes:"Client wants 6 more pot lights in rec room"},{id:2,jobId:1,title:"Move bathroom location 4ft east",amount:1200,status:"Pending",dateRequested:"2026-02-22",dateApproved:"",notes:"Requires additional plumbing rough-in"},{id:3,jobId:2,title:"Upgrade to insulated steel door",amount:650,status:"Approved",dateRequested:"2026-02-10",dateApproved:"2026-02-12",notes:"Upgrade from basic to insulated"}];
const initCosts=[{id:1,jobId:1,category:"Materials",description:"Lumber & framing materials",amount:2800,date:"2026-02-10"},{id:2,jobId:1,category:"Materials",description:"Electrical rough-in materials",amount:420,date:"2026-02-18"},{id:3,jobId:1,category:"Subcontractor",description:"Rick Paulson ‚Äì Electrical rough-in",amount:1400,date:"2026-03-05"},{id:4,jobId:1,category:"Subcontractor",description:"Torres Plumbing ‚Äì Rough-in",amount:1100,date:"2026-03-10"},{id:5,jobId:1,category:"Other",description:"Permit fees",amount:320,date:"2026-02-03"},{id:6,jobId:2,category:"Materials",description:"Concrete & rebar",amount:4200,date:"2026-04-20"},{id:7,jobId:2,category:"Subcontractor",description:"Flatland Concrete ‚Äì foundation",amount:3800,date:"2026-04-22"}];
const CO_STATUSES=["Pending","Approved","Rejected"];
const COST_CATEGORIES=["Materials","Subcontractor","Equipment","Permit","Other"];
const LEAD_STAGES=["New","Quoted","Follow-up","Won","Lost"];
const JOB_STATUSES=["Upcoming","Active","Completed","On Hold"];
const EVENT_TYPES=["inspection","site","quote","sub","meeting","milestone","other"];
const EC={inspection:"#F59E0B",site:"#C8A96A",quote:"#60A5FA",sub:"#4CAF50",meeting:"#C084FC",milestone:"#4ade80",other:"#6B7280"};
function Badge({label}){const m={Active:{bg:"#14532d22",t:"#4ade80"},Upcoming:{bg:"#1e3a5f22",t:"#60A5FA"},Completed:{bg:"#1c1c1c",t:"#6B7280"},"On Hold":{bg:"#7c2d1222",t:"#FB923C"},Won:{bg:"#14532d22",t:"#4ade80"},Lost:{bg:"#7f1d1d22",t:"#F87171"},New:{bg:"#1e3a5f22",t:"#60A5FA"},Quoted:{bg:"#78350f22",t:"#C8A96A"},"Follow-up":{bg:"#581c8722",t:"#C084FC"},"In Progress":{bg:"#78350f22",t:"#C8A96A"},"Not Started":{bg:"#1c1c1c",t:"#6B7280"}};const c=m[label]||{bg:"#1c1c1c",t:"#6B7280"};return <span style={{background:c.bg,color:c.t,padding:"2px 10px",borderRadius:20,fontSize:11,fontWeight:600,whiteSpace:"nowrap"}}>{label}</span>;}
function Card({children,style={},onClick}){const [h,setH]=useState(false);return <div onClick={onClick} onMouseEnter={()=>onClick&&setH(true)} onMouseLeave={()=>setH(false)} style={{background:"#2C3E50",border:`1px solid ${h?"#C8A96A":"#2E3D4F"}`,borderRadius:10,padding:18,cursor:onClick?"pointer":"default",transition:"border-color 0.15s",...style}}>{children}</div>;}
function Inp({label,value,onChange,type="text",placeholder=""}){return <div style={{marginBottom:11}}>{label&&<label style={{display:"block",fontSize:11,color:"#6B7280",marginBottom:3,textTransform:"uppercase",letterSpacing:"0.06em"}}>{label}</label>}<input type={type} value={value} onChange={e=>onChange(e.target.value)} placeholder={placeholder} style={{width:"100%",background:"#1F2A37",border:"1px solid #2E3D4F",borderRadius:6,padding:"8px 11px",color:"#FFFFFF",fontSize:13,fontFamily:"system-ui,-apple-system,sans-serif",outline:"none",boxSizing:"border-box"}}/></div>;}
function Txtarea({label,value,onChange,placeholder="",rows=4}){return <div style={{marginBottom:11}}>{label&&<label style={{display:"block",fontSize:11,color:"#6B7280",marginBottom:3,textTransform:"uppercase",letterSpacing:"0.06em"}}>{label}</label>}<textarea value={value} onChange={e=>onChange(e.target.value)} placeholder={placeholder} rows={rows} style={{width:"100%",background:"#1F2A37",border:"1px solid #2E3D4F",borderRadius:6,padding:"8px 11px",color:"#FFFFFF",fontSize:13,fontFamily:"system-ui,-apple-system,sans-serif",outline:"none",boxSizing:"border-box",resize:"vertical",lineHeight:1.5}}/></div>;}
function Sel({label,value,onChange,options,display}){const opts=display||options;return <div style={{marginBottom:11}}>{label&&<label style={{display:"block",fontSize:11,color:"#6B7280",marginBottom:3,textTransform:"uppercase",letterSpacing:"0.06em"}}>{label}</label>}<select value={value} onChange={e=>onChange(e.target.value)} style={{width:"100%",background:"#1F2A37",border:"1px solid #2E3D4F",borderRadius:6,padding:"8px 11px",color:"#FFFFFF",fontSize:13,fontFamily:"system-ui,-apple-system,sans-serif",outline:"none",boxSizing:"border-box"}}>{options.map((o,i)=><option key={String(o)} value={o}>{opts?opts[i]:o}</option>)}</select></div>;}
function Btn({children,onClick,variant="primary",size="md",style={}}){const v={primary:{background:"#C8A96A",color:"#1F2A37"},ghost:{background:"transparent",color:"#C8A96A",border:"1px solid #2E3D4F"},danger:{background:"transparent",color:"#EF4444",border:"1px solid #2E3D4F"}};const s={sm:{padding:"4px 11px",fontSize:11},md:{padding:"8px 17px",fontSize:13}};return <button onClick={onClick} style={{cursor:"pointer",borderRadius:6,fontFamily:"system-ui,-apple-system,sans-serif",fontWeight:600,border:"none",...v[variant],...s[size],...style}}>{children}</button>;}
function Modal({title,onClose,children,wide=false}){return <div style={{position:"fixed",inset:0,background:"#00000090",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2000,padding:16}}><div style={{background:"#2C3E50",border:"1px solid #2E3D4F",borderRadius:12,padding:24,width:"100%",maxWidth:wide?700:500,maxHeight:"92vh",overflowY:"auto"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18}}><h2 style={{margin:0,color:"#FFFFFF",fontFamily:"'Georgia',serif",fontSize:19}}>{title}</h2><button onClick={onClose} style={{background:"none",border:"none",color:"#6B7280",fontSize:22,cursor:"pointer",lineHeight:1}}>√ó</button></div>{children}</div></div>;}
function Toggle({checked,onChange,label}){return <label style={{display:"flex",alignItems:"center",gap:10,cursor:"pointer",userSelect:"none"}}><div onClick={()=>onChange(!checked)} style={{width:38,height:20,borderRadius:10,background:checked?"#C8A96A":"#2E3D4F",position:"relative",transition:"background 0.2s",flexShrink:0,cursor:"pointer"}}><div style={{position:"absolute",top:3,left:checked?19:3,width:14,height:14,borderRadius:"50%",background:checked?"#1F2A37":"#6B7280",transition:"left 0.2s"}}/></div>{label&&<span style={{fontSize:12,color:checked?"#C8A96A":"#6B7280"}}>{label}</span>}</label>;}
function Milestones({job,onUpdate}){const [items,setItems]=useState(job.milestones||[]);const [nm,setNm]=useState("");const [nd,setNd]=useState("");const drag=useRef(null);function save(u){setItems(u);onUpdate(u);}function toggle(id){save(items.map(m=>m.id!==id?m:{...m,status:m.status==="Completed"?"Not Started":m.status==="Not Started"?"In Progress":"Completed"}));}function add(){if(!nm.trim())return;save([...items,{id:Date.now(),name:nm.trim(),date:nd,status:"Not Started",order:items.length}]);setNm("");setNd("");}function del(id){save(items.filter(m=>m.id!==id));}const icon={"Completed":"‚úÖ","In Progress":"üîÑ","Not Started":"‚óã"};return <div><div style={{fontSize:11,color:"#6B7280",marginBottom:8}}>Drag ‚†ø to reorder ¬∑ click icon to cycle status</div>{items.length===0&&<div style={{color:"#6B7280",textAlign:"center",padding:"14px 0",fontSize:12}}>No milestones yet.</div>}{items.map((m,i)=>(<div key={m.id} draggable onDragStart={()=>{drag.current=i;}} onDragOver={e=>{e.preventDefault();if(drag.current===null||drag.current===i)return;const u=[...items];const[mv]=u.splice(drag.current,1);u.splice(i,0,mv);drag.current=i;save(u.map((x,idx)=>({...x,order:idx})));}} onDragEnd={()=>{drag.current=null;}} style={{display:"flex",alignItems:"center",gap:8,padding:"8px 10px",borderRadius:7,marginBottom:5,background:m.status==="Completed"?"#14532d22":m.status==="In Progress"?"#C8A96A11":"#1F2A37",border:`1px solid ${m.status==="Completed"?"#4ade8033":m.status==="In Progress"?"#C8A96A44":"#2E3D4F"}`,cursor:"grab"}}><span style={{color:"#6B7280",fontSize:13,userSelect:"none"}}>‚†ø</span><button onClick={()=>toggle(m.id)} style={{background:"none",border:"none",cursor:"pointer",fontSize:15,padding:0,lineHeight:1}}>{icon[m.status]}</button><div style={{flex:1}}><div style={{color:m.status==="Completed"?"#6B7280":"#FFFFFF",fontSize:12,fontWeight:600,textDecoration:m.status==="Completed"?"line-through":"none"}}>{m.name}</div>{m.date&&<div style={{fontSize:10,color:"#6B7280"}}>{fmtDate(m.date)}</div>}</div><Badge label={m.status}/><button onClick={()=>del(m.id)} style={{background:"none",border:"none",color:"#6B7280",cursor:"pointer",fontSize:15,lineHeight:1}}>√ó</button></div>))}<div style={{display:"flex",gap:7,marginTop:10,alignItems:"flex-end",flexWrap:"wrap"}}><div style={{flex:1,minWidth:140}}><Inp label="New Milestone" value={nm} onChange={setNm} placeholder="e.g. Pour footings"/></div><div style={{width:130}}><Inp label="Date" value={nd} onChange={setNd} type="date"/></div><Btn onClick={add} style={{marginBottom:11}}>Add</Btn></div></div>;}
function Gantt({jobs}){const active=jobs.filter(j=>j.startDate&&j.endDate&&j.status!=="Completed");if(active.length===0)return <div style={{color:"#6B7280",textAlign:"center",padding:28,fontSize:12}}>No active/upcoming projects with dates.</div>;const allD=active.flatMap(j=>[new Date(j.startDate),new Date(j.endDate)]);const mn=new Date(Math.min(...allD));mn.setDate(mn.getDate()-7);const mx=new Date(Math.max(...allD));mx.setDate(mx.getDate()+14);const total=Math.ceil((mx-mn)/86400000);const months=[];let cur=new Date(mn);while(cur<mx){const me=new Date(cur.getFullYear(),cur.getMonth()+1,0);const s=Math.max(0,Math.ceil((new Date(cur.getFullYear(),cur.getMonth(),1)-mn)/86400000));const e=Math.min(total,Math.ceil((me-mn)/86400000));months.push({label:cur.toLocaleDateString("en-CA",{month:"short",year:"2-digit"}),width:e-s});cur=new Date(cur.getFullYear(),cur.getMonth()+1,1);}const CELL=26,ROW=42,LEFT=170;const todayOff=Math.ceil((new Date()-mn)/86400000);const BAR={Active:"#C8A96A",Upcoming:"#60A5FA","On Hold":"#F59E0B"};return <div style={{overflowX:"auto"}}><div style={{minWidth:LEFT+total*CELL}}><div style={{display:"flex",marginLeft:LEFT,marginBottom:3}}>{months.map((m,i)=><div key={i} style={{width:m.width*CELL,fontSize:10,color:"#6B7280",borderLeft:"1px solid #2E3D4F",paddingLeft:4,flexShrink:0}}>{m.label}</div>)}</div><div style={{position:"relative"}}>{todayOff>0&&todayOff<total&&<div style={{position:"absolute",left:LEFT+todayOff*CELL,top:0,bottom:0,width:2,background:"#EF4444",zIndex:10,opacity:0.8}}><div style={{position:"absolute",top:-14,left:-10,background:"#EF4444",color:"#FFFFFF",fontSize:9,padding:"1px 4px",borderRadius:3,whiteSpace:"nowrap"}}>TODAY</div></div>}{active.map(job=>{const js=Math.ceil((new Date(job.startDate)-mn)/86400000);const je=Math.ceil((new Date(job.endDate)-mn)/86400000);const jw=Math.max(1,je-js);const bc=BAR[job.status]||"#6B7280";return <div key={job.id} style={{display:"flex",alignItems:"center",height:ROW,borderBottom:"1px solid #2E3D4F"}}><div style={{width:LEFT,flexShrink:0,paddingRight:8}}><div style={{fontSize:11,fontWeight:600,color:"#FFFFFF",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{job.name}</div><div style={{fontSize:10,color:"#6B7280"}}>{job._clientName||""}</div></div><div style={{position:"relative",flex:1,height:ROW,display:"flex",alignItems:"center"}}>{Array.from({length:total}).map((_,d)=><div key={d} style={{position:"absolute",left:d*CELL,width:CELL,height:ROW,borderLeft:d%7===0?"1px solid #2E3D4F":"none"}}/>)}<div style={{position:"absolute",left:js*CELL,width:jw*CELL,height:20,background:bc+"33",border:`1px solid ${bc}`,borderRadius:4,overflow:"hidden",display:"flex",alignItems:"center",paddingLeft:4}}><div style={{width:`${job.progress}%`,height:"100%",position:"absolute",left:0,top:0,background:bc+"55"}}/><span style={{position:"relative",fontSize:9,color:"#FFFFFF",fontWeight:700}}>{job.progress}%</span></div>{(job.milestones||[]).filter(m=>m.date).map(m=>{const off=Math.ceil((new Date(m.date)-mn)/86400000);if(off<0||off>total)return null;const mc=m.status==="Completed"?"#4ade80":m.status==="In Progress"?"#C8A96A":"#6B7280";return <div key={m.id} title={`${m.name} ‚Äî ${fmtDate(m.date)}`} style={{position:"absolute",left:off*CELL-5,width:10,height:10,background:mc,transform:"rotate(45deg)",borderRadius:2,zIndex:5}}/>;})}</div></div>;})}}</div></div>;}
function Dashboard({jobs,leads,clients,logs,setPage}){const active=jobs.filter(j=>j.status==="Active");const pipe=leads.filter(l=>!["Won","Lost"].includes(l.stage)).reduce((s,l)=>s+l.value,0);const out=jobs.reduce((s,j)=>s+(j.value-j.paid),0);const won=leads.filter(l=>l.stage==="Won").reduce((s,l)=>s+l.value,0);const getClient=id=>clients.find(c=>c.id===id);const recentLogs=[...logs].sort((a,b)=>b.date.localeCompare(a.date)).slice(0,3);return <div><h1 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:26,marginBottom:3}}>Good morning, Evan.</h1><p style={{color:"#6B7280",marginBottom:22,fontSize:13}}>Here's where things stand today.</p><div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(130px,1fr))",gap:10,marginBottom:22}}>{[{label:"Active Jobs",value:active.length,sub:"in progress",color:"#C8A96A"},{label:"Pipeline",value:fmt$(pipe),sub:"open leads",color:"#60A5FA"},{label:"Outstanding",value:fmt$(out),sub:"receivable",color:"#F59E0B"},{label:"Won",value:fmt$(won),sub:"closed",color:"#4ade80"}].map(k=>(<Card key={k.label}><div style={{fontSize:10,color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.06em",marginBottom:4}}>{k.label}</div><div style={{fontSize:22,fontFamily:"'Georgia',serif",color:k.color,marginBottom:1}}>{k.value}</div><div style={{fontSize:10,color:"#6B7280"}}>{k.sub}</div></Card>))}</div><h2 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:17,marginBottom:10}}>Active Projects</h2><div style={{display:"grid",gap:9,marginBottom:22}}>{active.map(job=>{const cl=getClient(job.clientId);const done=job.milestones.filter(m=>m.status==="Completed").length;const tot=job.milestones.length;return <Card key={job.id} onClick={()=>setPage("jobs")}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:7}}><div><div style={{fontWeight:700,color:"#FFFFFF",fontSize:14}}>{job.name}</div><div style={{color:"#6B7280",fontSize:11,marginTop:1}}>{cl?.name} ¬∑ {job.address}</div></div><Badge label={job.status}/></div><div style={{marginTop:10}}><div style={{display:"flex",justifyContent:"space-between",fontSize:11,color:"#6B7280",marginBottom:3}}><span>{done}/{tot} milestones</span><span>{job.progress}%</span></div><div style={{background:"#2E3D4F",borderRadius:4,height:5}}><div style={{background:"#C8A96A",borderRadius:4,height:5,width:`${job.progress}%`,transition:"width 0.5s"}}/></div></div></Card>;})} </div>{recentLogs.length>0&&<><h2 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:17,marginBottom:10}}>Recent Site Logs</h2><div style={{display:"grid",gap:9,marginBottom:22}}>{recentLogs.map(log=>{const job=jobs.find(j=>j.id===log.jobId);return(<Card key={log.id} onClick={()=>setPage("logs")} style={{padding:13}}><div style={{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:7}}><div><div style={{fontWeight:700,color:"#FFFFFF",fontSize:13}}>{job?.name||"General"}</div><div style={{color:"#6B7280",fontSize:11,marginTop:2}}>{fmtDate(log.date)} ¬∑ {log.weather} ¬∑ {log.crew} crew ¬∑ {log.hours}h</div><div style={{color:"#6B7280",fontSize:11,marginTop:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:280}}>{log.notes}</div></div><div style={{display:"flex",gap:6,alignItems:"flex-start",flexShrink:0}}>{log.photos.length>0&&<span style={{fontSize:10,color:"#6B7280"}}>üì∑ {log.photos.length}</span>}{log.visibleToClient&&<span style={{fontSize:10,color:"#4ade80"}}>‚úì Client</span>}</div></div></Card>);})}</div></>}<h2 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:17,marginBottom:10}}>Recent Leads</h2><Card>{leads.slice(0,4).map((l,i)=>(<div key={l.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:i<3?"1px solid #2E3D4F":"none",flexWrap:"wrap",gap:7}}><div><span style={{color:"#FFFFFF",fontWeight:600,fontSize:12}}>{l.name}</span><span style={{color:"#6B7280",fontSize:11,marginLeft:7}}>{l.type}</span></div><div style={{display:"flex",gap:9,alignItems:"center"}}><span style={{color:"#C8A96A",fontWeight:700,fontSize:12}}>{fmt$(l.value)}</span><Badge label={l.stage}/></div></div>))}</Card></div>;}
function Clients({clients,setClients,jobs}){const [showM,setShowM]=useState(false);const [sel,setSel]=useState(null);const [form,setForm]=useState({});const f=(k,v)=>setForm(p=>({...p,[k]:v}));function openNew(){setForm({name:"",phone:"",email:"",notes:""});setSel(null);setShowM(true);}function openEdit(c){setForm({...c});setSel(c);setShowM(true);}function save(){const u={...form};if(sel)setClients(cs=>cs.map(c=>c.id===sel.id?{...u,id:c.id}:c));else setClients(cs=>[...cs,{...u,id:Date.now()}]);setShowM(false);}function del(){if(!sel)return;setClients(cs=>cs.filter(c=>c.id!==sel.id));setShowM(false);}return <div><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexWrap:"wrap",gap:10}}><h1 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:26,margin:0}}>Clients</h1><Btn onClick={openNew}>+ Add Client</Btn></div><div style={{display:"grid",gap:10}}>{clients.map(c=>{const cJobs=jobs.filter(j=>j.clientId===c.id);return(<Card key={c.id} onClick={()=>openEdit(c)}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:8}}><div><div style={{fontWeight:700,color:"#FFFFFF",fontSize:15}}>{c.name}</div><div style={{fontSize:12,color:"#6B7280",marginTop:2}}>{c.phone} ¬∑ {c.email}</div>{c.notes&&<div style={{fontSize:11,color:"#6B7280",marginTop:4}}>üìù {c.notes}</div>}</div><div style={{textAlign:"right"}}><div style={{fontSize:11,color:"#6B7280",marginBottom:5}}>{cJobs.length} project{cJobs.length!==1?"s":""}</div><div style={{display:"flex",gap:4,flexWrap:"wrap",justifyContent:"flex-end"}}>{cJobs.map(j=><Badge key={j.id} label={j.status}/>)}</div></div></div>{cJobs.length>0&&<div style={{marginTop:10,display:"flex",gap:5,flexWrap:"wrap"}}>{cJobs.map(j=><span key={j.id} style={{fontSize:10,padding:"2px 8px",borderRadius:10,background:"#1F2A37",color:"#6B7280",border:"1px solid #2E3D4F"}}>{j.name}</span>)}</div>}</Card>);})}</div>{showM&&<Modal title={sel?"Edit Client":"Add Client"} onClose={()=>setShowM(false)}><Inp label="Full Name" value={form.name||""} onChange={v=>f("name",v)}/><Inp label="Phone" value={form.phone||""} onChange={v=>f("phone",v)}/><Inp label="Email" value={form.email||""} onChange={v=>f("email",v)} type="email"/><Inp label="Notes" value={form.notes||""} onChange={v=>f("notes",v)} placeholder="Referral source, preferences..."/><div style={{display:"flex",gap:9,justifyContent:"flex-end",marginTop:10}}>{sel&&<Btn variant="danger" onClick={del}>Delete</Btn>}<Btn variant="ghost" onClick={()=>setShowM(false)}>Cancel</Btn><Btn onClick={save}>Save</Btn></div></Modal>}</div>;}
function DailyLog({logs,setLogs,jobs,clients}){const [showM,setShowM]=useState(false);const [sel,setSel]=useState(null);const [form,setForm]=useState({});const [lightbox,setLightbox]=useState(null);const [filterJob,setFilterJob]=useState("all");const fileRef=useRef(null);const f=(k,v)=>setForm(p=>({...p,[k]:v}));const blank={jobId:"",date:todayStr(),weather:"‚òÄÔ∏è Sunny",crew:2,hours:8,notes:"",visibleToClient:false,photos:[]};function openNew(){setForm({...blank});setSel(null);setShowM(true);}function openEdit(log){setForm({...log,jobId:log.jobId||""});setSel(log);setShowM(true);}function save(){const u={...form,crew:+form.crew,hours:+form.hours,jobId:form.jobId?+form.jobId:null};if(sel)setLogs(ls=>ls.map(l=>l.id===sel.id?{...u,id:l.id}:l));else setLogs(ls=>[{...u,id:Date.now()},...ls]);setShowM(false);}function del(){if(!sel)return;setLogs(ls=>ls.filter(l=>l.id!==sel.id));setShowM(false);}function handlePhotos(e){Array.from(e.target.files).forEach(file=>{const reader=new FileReader();reader.onload=ev=>f("photos",[...(form.photos||[]),{id:Date.now()+Math.random(),name:file.name,url:ev.target.result}]);reader.readAsDataURL(file);});e.target.value="";}function removePhoto(id){f("photos",(form.photos||[]).filter(p=>p.id!==id));}const sorted=[...logs].sort((a,b)=>b.date.localeCompare(a.date));const filtered=filterJob==="all"?sorted:sorted.filter(l=>String(l.jobId)===filterJob);const getClient=id=>clients.find(c=>c.id===id);return <div><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:10}}><h1 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:26,margin:0}}>Daily Log</h1><Btn onClick={openNew}>+ New Entry</Btn></div><div style={{marginBottom:14,display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"}}><label style={{fontSize:11,color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.06em"}}>Project:</label><select value={filterJob} onChange={e=>setFilterJob(e.target.value)} style={{background:"#2C3E50",border:"1px solid #2E3D4F",borderRadius:7,padding:"6px 12px",color:"#FFFFFF",fontSize:12,fontFamily:"system-ui,-apple-system,sans-serif",outline:"none",cursor:"pointer"}}><option value="all">All Projects</option>{jobs.map(j=><option key={j.id} value={j.id}>{j.name}</option>)}</select>{filterJob!=="all"&&<button onClick={()=>setFilterJob("all")} style={{fontSize:11,color:"#6B7280",background:"none",border:"none",cursor:"pointer",textDecoration:"underline"}}>Clear</button>}</div>{filtered.length===0&&<div style={{color:"#6B7280",textAlign:"center",padding:"40px 0",fontSize:13}}>No log entries yet.</div>}<div style={{display:"grid",gap:12}}>{filtered.map(log=>{const job=jobs.find(j=>j.id===log.jobId);const cl=job?getClient(job.clientId):null;return <Card key={log.id} style={{padding:0,overflow:"hidden"}}><div style={{padding:"12px 16px",borderBottom:"1px solid #2E3D4F",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:8}}><div><div style={{fontWeight:700,color:"#FFFFFF",fontSize:14}}>{job?.name||"General"}</div><div style={{fontSize:11,color:"#6B7280",marginTop:2}}>{fmtDate(log.date)}{cl?` ¬∑ ${cl.name}`:""}</div></div><div style={{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}}>{log.visibleToClient&&<span style={{fontSize:10,padding:"2px 8px",borderRadius:10,background:"#14532d22",color:"#4ade80"}}>‚úì Client visible</span>}<Btn size="sm" variant="ghost" onClick={()=>openEdit(log)}>Edit</Btn></div></div><div style={{padding:"10px 16px",display:"flex",gap:22,flexWrap:"wrap",borderBottom:"1px solid #2E3D4F"}}>{[{e:"üå§",l:"Weather",v:log.weather},{e:"üë∑",l:"Crew",v:`${log.crew} workers`},{e:"‚è±",l:"Hours",v:`${log.hours}h on site`}].map(s=>(<div key={s.l}><div style={{fontSize:10,color:"#6B7280",marginBottom:2}}>{s.e} {s.l}</div><div style={{fontSize:12,color:"#FFFFFF",fontWeight:600}}>{s.v}</div></div>))}</div><div style={{padding:"10px 16px"}}><div style={{fontSize:12,color:"#6B7280",lineHeight:1.6,whiteSpace:"pre-wrap"}}>{log.notes||<span style={{fontStyle:"italic"}}>No notes.</span>}</div></div>{log.photos&&log.photos.length>0&&(<div style={{padding:"0 16px 14px",display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(80px,1fr))",gap:6}}>{log.photos.map(photo=>(<div key={photo.id} onClick={()=>setLightbox(photo)} style={{cursor:"pointer",borderRadius:6,overflow:"hidden",aspectRatio:"1",background:"#2E3D4F"}}><img src={photo.url} alt={photo.name} style={{width:"100%",height:"100%",objectFit:"cover",display:"block"}}/></div>))}</div>)}</Card>;})} </div>{lightbox&&<div onClick={()=>setLightbox(null)} style={{position:"fixed",inset:0,background:"#000000CC",zIndex:3000,display:"flex",alignItems:"center",justifyContent:"center",padding:20,cursor:"zoom-out"}}><img src={lightbox.url} alt={lightbox.name} style={{maxWidth:"100%",maxHeight:"90vh",borderRadius:8,boxShadow:"0 0 60px #000"}}/><div style={{position:"absolute",bottom:24,color:"#6B7280",fontSize:12}}>click to close</div></div>}{showM&&<Modal title={sel?"Edit Log Entry":"New Log Entry"} onClose={()=>setShowM(false)} wide><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}><Sel label="Project" value={form.jobId||""} onChange={v=>f("jobId",v)} options={["",...jobs.map(j=>j.id)]} display={["(No project)",...jobs.map(j=>j.name)]}/><Inp label="Date" type="date" value={form.date||""} onChange={v=>f("date",v)}/></div><Sel label="Weather" value={form.weather||"‚òÄÔ∏è Sunny"} onChange={v=>f("weather",v)} options={WEATHER}/><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}><Inp label="Crew on Site" type="number" value={form.crew||""} onChange={v=>f("crew",v)}/><Inp label="Hours Worked" type="number" value={form.hours||""} onChange={v=>f("hours",v)}/></div><Txtarea label="What was done today" value={form.notes||""} onChange={v=>f("notes",v)} placeholder="Work completed, issues, materials used..." rows={5}/><div style={{marginBottom:14}}><label style={{display:"block",fontSize:11,color:"#6B7280",marginBottom:6,textTransform:"uppercase",letterSpacing:"0.06em"}}>Photos</label><button onClick={()=>fileRef.current.click()} style={{padding:"8px 14px",background:"transparent",border:"1px dashed #C8A96A",borderRadius:7,color:"#C8A96A",fontSize:12,cursor:"pointer",fontFamily:"system-ui,-apple-system,sans-serif"}}>üì∑ Upload Photos</button><input ref={fileRef} type="file" accept="image/*" multiple style={{display:"none"}} onChange={handlePhotos}/>{(form.photos||[]).length>0&&(<div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(70px,1fr))",gap:6,marginTop:10}}>{(form.photos||[]).map(photo=>(<div key={photo.id} style={{position:"relative",borderRadius:6,overflow:"hidden",aspectRatio:"1",background:"#2E3D4F"}}><img src={photo.url} alt={photo.name} style={{width:"100%",height:"100%",objectFit:"cover",display:"block"}}/><button onClick={()=>removePhoto(photo.id)} style={{position:"absolute",top:2,right:2,background:"#00000099",border:"none",borderRadius:"50%",width:18,height:18,color:"#FFFFFF",cursor:"pointer",fontSize:12,lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center"}}>√ó</button></div>))}</div>)}</div><div style={{marginBottom:14,padding:"12px 14px",background:"#1F2A37",borderRadius:8,border:"1px solid #2E3D4F"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{fontSize:12,color:"#FFFFFF",fontWeight:600}}>Visible to Client</div><div style={{fontSize:11,color:"#6B7280",marginTop:2}}>Client sees this entry and photos in their portal</div></div><Toggle checked={form.visibleToClient||false} onChange={v=>f("visibleToClient",v)}/></div></div><div style={{display:"flex",gap:9,justifyContent:"flex-end",marginTop:8}}>{sel&&<Btn variant="danger" onClick={del}>Delete</Btn>}<Btn variant="ghost" onClick={()=>setShowM(false)}>Cancel</Btn><Btn onClick={save}>Save Entry</Btn></div></Modal>}</div>;}
function ChangeOrders({job,changeOrders,setChangeOrders}){const jobCOs=changeOrders.filter(c=>c.jobId===job.id);const [showM,setShowM]=useState(false);const [sel,setSel]=useState(null);const [form,setForm]=useState({});const f=(k,v)=>setForm(p=>({...p,[k]:v}));const approved=jobCOs.filter(c=>c.status==="Approved").reduce((s,c)=>s+c.amount,0);const pending=jobCOs.filter(c=>c.status==="Pending").reduce((s,c)=>s+c.amount,0);function openNew(){setForm({title:"",amount:"",status:"Pending",dateRequested:todayStr(),dateApproved:"",notes:""});setSel(null);setShowM(true);}function openEdit(c){setForm({...c,amount:String(c.amount)});setSel(c);setShowM(true);}function save(){const u={...form,amount:+form.amount,jobId:job.id};if(sel)setChangeOrders(cs=>cs.map(c=>c.id===sel.id?{...u,id:c.id}:c));else setChangeOrders(cs=>[...cs,{...u,id:Date.now()}]);setShowM(false);}function del(){setChangeOrders(cs=>cs.filter(c=>c.id!==sel.id));setShowM(false);}const SC={Approved:{bg:"#14532d22",t:"#4ade80"},Pending:{bg:"#78350f22",t:"#F59E0B"},Rejected:{bg:"#7f1d1d22",t:"#F87171"}};return <div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:9,marginBottom:14}}>{[{label:"Original Contract",val:fmt$(job.value),c:"#FFFFFF"},{label:"Approved Changes",val:fmt$(approved),c:"#4ade80"},{label:"Revised Contract",val:fmt$(job.value+approved),c:"#C8A96A"},{label:"Pending Changes",val:fmt$(pending),c:"#F59E0B"}].map(k=>(<Card key={k.label} style={{padding:11}}><div style={{fontSize:10,color:"#6B7280",textTransform:"uppercase",marginBottom:3}}>{k.label}</div><div style={{fontFamily:"'Georgia',serif",fontSize:16,color:k.c}}>{k.val}</div></Card>))}</div><div style={{display:"flex",justifyContent:"flex-end",marginBottom:10}}><Btn onClick={openNew}>+ New Change Order</Btn></div>{jobCOs.length===0&&<div style={{color:"#6B7280",textAlign:"center",padding:"28px 0",fontSize:12}}>No change orders yet.</div>}{jobCOs.map(co=>{const s=SC[co.status]||{bg:"#1c1c1c",t:"#6B7280"};return(<Card key={co.id} onClick={()=>openEdit(co)} style={{marginBottom:8,padding:13,borderLeft:`3px solid ${s.t}`}}><div style={{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:8}}><div style={{flex:1}}><div style={{fontWeight:700,color:"#FFFFFF",fontSize:13}}>{co.title}</div><div style={{fontSize:11,color:"#6B7280",marginTop:2}}>Requested: {fmtDate(co.dateRequested)}{co.dateApproved?` ¬∑ Approved: ${fmtDate(co.dateApproved)}`:""}</div>{co.notes&&<div style={{fontSize:11,color:"#6B7280",marginTop:4}}>üìù {co.notes}</div>}</div><div style={{textAlign:"right",flexShrink:0}}><div style={{color:"#C8A96A",fontWeight:700,fontSize:15,marginBottom:4}}>+{fmt$(co.amount)}</div><span style={{fontSize:10,padding:"2px 9px",borderRadius:10,background:s.bg,color:s.t}}>{co.status}</span></div></div></Card>);})}{showM&&<Modal title={sel?"Edit Change Order":"New Change Order"} onClose={()=>setShowM(false)}><Inp label="Description" value={form.title||""} onChange={v=>f("title",v)} placeholder="e.g. Add pot lights in rec room"/><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}><Inp label="Amount ($)" type="number" value={form.amount||""} onChange={v=>f("amount",v)}/><Sel label="Status" value={form.status||"Pending"} onChange={v=>f("status",v)} options={CO_STATUSES}/></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}><Inp label="Date Requested" type="date" value={form.dateRequested||""} onChange={v=>f("dateRequested",v)}/><Inp label="Date Approved" type="date" value={form.dateApproved||""} onChange={v=>f("dateApproved",v)}/></div><Txtarea label="Notes" value={form.notes||""} onChange={v=>f("notes",v)} rows={3}/><div style={{display:"flex",gap:9,justifyContent:"flex-end",marginTop:10}}>{sel&&<Btn variant="danger" onClick={del}>Delete</Btn>}<Btn variant="ghost" onClick={()=>setShowM(false)}>Cancel</Btn><Btn onClick={save}>Save</Btn></div></Modal>}</div>;}
function JobCosting({job,costs,setCosts}){const jobCosts=costs.filter(c=>c.jobId===job.id);const [showM,setShowM]=useState(false);const [sel,setSel]=useState(null);const [form,setForm]=useState({});const f=(k,v)=>setForm(p=>({...p,[k]:v}));function openNew(){setForm({category:"Materials",description:"",amount:"",date:todayStr()});setSel(null);setShowM(true);}function openEdit(c){setForm({...c,amount:String(c.amount)});setSel(c);setShowM(true);}function save(){const u={...form,amount:+form.amount,jobId:job.id};if(sel)setCosts(cs=>cs.map(c=>c.id===sel.id?{...u,id:c.id}:c));else setCosts(cs=>[...cs,{...u,id:Date.now()}]);setShowM(false);}function del(){setCosts(cs=>cs.filter(c=>c.id!==sel.id));setShowM(false);}const totalCost=jobCosts.reduce((s,c)=>s+c.amount,0);const grossProfit=job.value-totalCost;const margin=job.value>0?Math.round((grossProfit/job.value)*100):0;const byCategory=COST_CATEGORIES.reduce((acc,cat)=>({...acc,[cat]:jobCosts.filter(c=>c.category===cat).reduce((s,c)=>s+c.amount,0)}),{});const CAT_COLORS={Materials:"#60A5FA",Subcontractor:"#C8A96A",Equipment:"#C084FC",Permit:"#F59E0B",Other:"#6B7280"};return <div><div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(110px,1fr))",gap:9,marginBottom:14}}>{[{label:"Contract Value",val:fmt$(job.value),c:"#FFFFFF"},{label:"Total Costs",val:fmt$(totalCost),c:"#F87171"},{label:"Gross Profit",val:fmt$(grossProfit),c:grossProfit>=0?"#4ade80":"#F87171"},{label:"Margin",val:`${margin}%`,c:margin>=20?"#4ade80":margin>=10?"#F59E0B":"#F87171"}].map(k=>(<Card key={k.label} style={{padding:11}}><div style={{fontSize:10,color:"#6B7280",textTransform:"uppercase",marginBottom:3}}>{k.label}</div><div style={{fontFamily:"'Georgia',serif",fontSize:17,color:k.c}}>{k.val}</div></Card>))}</div><Card style={{marginBottom:12,padding:13}}><div style={{fontSize:12,fontWeight:700,color:"#FFFFFF",marginBottom:10}}>Cost Breakdown</div>{COST_CATEGORIES.map(cat=>{const amt=byCategory[cat];if(!amt)return null;const pct=totalCost>0?Math.round((amt/totalCost)*100):0;return(<div key={cat} style={{marginBottom:8}}><div style={{display:"flex",justifyContent:"space-between",fontSize:11,marginBottom:3}}><span style={{color:CAT_COLORS[cat]||"#6B7280",fontWeight:600}}>{cat}</span><span style={{color:"#FFFFFF"}}>{fmt$(amt)} <span style={{color:"#6B7280"}}>({pct}%)</span></span></div><div style={{background:"#2E3D4F",borderRadius:4,height:5}}><div style={{background:CAT_COLORS[cat]||"#6B7280",borderRadius:4,height:5,width:`${pct}%`,transition:"width 0.5s"}}/></div></div>);})}</Card><div style={{display:"flex",justifyContent:"flex-end",marginBottom:10}}><Btn onClick={openNew}>+ Add Cost</Btn></div>{jobCosts.length===0&&<div style={{color:"#6B7280",textAlign:"center",padding:"28px 0",fontSize:12}}>No costs logged yet.</div>}{COST_CATEGORIES.map(cat=>{const cats=jobCosts.filter(c=>c.category===cat);if(!cats.length)return null;return(<div key={cat} style={{marginBottom:14}}><div style={{fontSize:11,color:CAT_COLORS[cat]||"#6B7280",fontWeight:700,textTransform:"uppercase",marginBottom:6,letterSpacing:"0.05em"}}>{cat}</div>{cats.map(c=>(<Card key={c.id} onClick={()=>openEdit(c)} style={{marginBottom:6,padding:"10px 13px"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:7}}><div><div style={{color:"#FFFFFF",fontSize:12,fontWeight:600}}>{c.description}</div><div style={{color:"#6B7280",fontSize:10,marginTop:2}}>{fmtDate(c.date)}</div></div><div style={{color:"#F87171",fontWeight:700,fontSize:14}}>{fmt$(c.amount)}</div></div></Card>))}</div>);})}{showM&&<Modal title={sel?"Edit Cost":"Add Cost"} onClose={()=>setShowM(false)}><Sel label="Category" value={form.category||"Materials"} onChange={v=>f("category",v)} options={COST_CATEGORIES}/><Inp label="Description" value={form.description||""} onChange={v=>f("description",v)} placeholder="e.g. 2x6 lumber, Rick Paulson electrical..."/><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}><Inp label="Amount ($)" type="number" value={form.amount||""} onChange={v=>f("amount",v)}/><Inp label="Date" type="date" value={form.date||""} onChange={v=>f("date",v)}/></div><div style={{display:"flex",gap:9,justifyContent:"flex-end",marginTop:10}}>{sel&&<Btn variant="danger" onClick={del}>Delete</Btn>}<Btn variant="ghost" onClick={()=>setShowM(false)}>Cancel</Btn><Btn onClick={save}>Save</Btn></div></Modal>}</div>;}
function PhotoGallery({job,logs}){const [filter,setFilter]=useState("all");const [lightbox,setLightbox]=useState(null);const jobLogs=logs.filter(l=>l.jobId===job.id&&l.photos&&l.photos.length>0).sort((a,b)=>a.date.localeCompare(b.date));const allPhotos=jobLogs.flatMap(log=>log.photos.map(p=>({...p,date:log.date,weather:log.weather,logId:log.id})));const phases=["all","Before","During","After"];const tagged=allPhotos.map((p,i)=>{const idx=jobLogs.findIndex(l=>l.photos.some(ph=>ph.id===p.id));const total=jobLogs.length;const phase=total===0?"During":idx===0&&total>1?"Before":idx===jobLogs.length-1&&total>1?"After":"During";return {...p,phase};});const visible=filter==="all"?tagged:tagged.filter(p=>p.phase===filter);if(allPhotos.length===0)return(<div style={{textAlign:"center",padding:"40px 20px"}}><div style={{fontSize:32,marginBottom:12}}>üì∑</div><div style={{color:"#6B7280",fontSize:13}}>No photos yet.</div><div style={{color:"#6B7280",fontSize:11,marginTop:4}}>Upload photos in Daily Log entries ‚Äî they'll appear here organized by date.</div></div>);return <div><div style={{display:"flex",gap:6,marginBottom:14,flexWrap:"wrap",alignItems:"center"}}>{phases.map(ph=><button key={ph} onClick={()=>setFilter(ph)} style={{padding:"4px 12px",borderRadius:20,border:`1px solid ${filter===ph?"#C8A96A":"#2E3D4F"}`,background:filter===ph?"#C8A96A22":"transparent",color:filter===ph?"#C8A96A":"#6B7280",cursor:"pointer",fontSize:11,fontFamily:"system-ui,-apple-system,sans-serif",textTransform:"capitalize"}}>{ph==="all"?`All (${allPhotos.length})`:ph}</button>)}</div>{jobLogs.filter(l=>l.photos&&l.photos.length>0).map(log=>(<div key={log.logId||log.date} style={{marginBottom:18}}><div style={{fontSize:11,color:"#6B7280",marginBottom:8,display:"flex",alignItems:"center",gap:8}}><span style={{color:"#C8A96A",fontWeight:600}}>{fmtDate(log.date)}</span><span>{log.weather}</span><span style={{flex:1,height:1,background:"#2E3D4F"}}/><span>{log.photos.length} photo{log.photos.length!==1?"s":""}</span></div><div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(120px,1fr))",gap:7}}>{log.photos.map(photo=>(<div key={photo.id} onClick={()=>setLightbox({...photo,date:log.date})} style={{cursor:"pointer",borderRadius:8,overflow:"hidden",aspectRatio:"1",background:"#2E3D4F",position:"relative",border:"1px solid #2E3D4F",transition:"border-color 0.15s"}} onMouseEnter={e=>e.currentTarget.style.borderColor="#C8A96A"} onMouseLeave={e=>e.currentTarget.style.borderColor="#2E3D4F"}><img src={photo.url} alt={photo.name} style={{width:"100%",height:"100%",objectFit:"cover",display:"block"}}/></div>))}</div></div>))}{lightbox&&<div onClick={()=>setLightbox(null)} style={{position:"fixed",inset:0,background:"#000000DD",zIndex:3000,display:"flex",alignItems:"center",justifyContent:"center",padding:20,cursor:"zoom-out"}}><div style={{maxWidth:"90vw",maxHeight:"90vh",position:"relative"}} onClick={e=>e.stopPropagation()}><img src={lightbox.url} alt={lightbox.name} style={{maxWidth:"100%",maxHeight:"85vh",borderRadius:8,boxShadow:"0 0 80px #000",display:"block"}}/><div style={{position:"absolute",bottom:-28,left:0,right:0,textAlign:"center",color:"#6B7280",fontSize:12}}>{lightbox.name} ¬∑ {fmtDate(lightbox.date)} ¬∑ click outside to close</div></div></div>}</div>;}
function Jobs({jobs,setJobs,clients,logs,changeOrders,setChangeOrders,costs,setCosts,events,setEvents}){const [detail,setDetail]=useState(null);const [showM,setShowM]=useState(false);const [sel,setSel]=useState(null);const [filter,setFilter]=useState("All");const [tab,setTab]=useState("milestones");const [form,setForm]=useState({});const f=(k,v)=>setForm(p=>({...p,[k]:v}));const filtered=filter==="All"?jobs:jobs.filter(j=>j.status===filter);const getClient=id=>clients.find(c=>c.id===id);function syncMilestoneEvents(jobId,milestones,jobName){setEvents(evs=>{const kept=evs.filter(e=>!(e.type==="milestone"&&e.jobId===jobId));const newEvs=milestones.filter(m=>m.date).map(m=>({id:`ms-${m.id}`,title:`${jobName} ‚Äî ${m.name}`,jobId,date:m.date,time:"08:00",type:"milestone",milestoneId:m.id}));return [...kept,...newEvs];});}function openNew(){setForm({name:"",clientId:"",address:"",type:"Deck",status:"Upcoming",value:"",paid:0,startDate:"",endDate:"",progress:0,notes:"",milestones:[],docs:[],sharedWithClient:false});setSel(null);setShowM(true);}function openEdit(job){setForm({...job,clientId:job.clientId||""});setSel(job);setShowM(true);}function save(){const u={...form,value:+form.value,paid:+form.paid,progress:+form.progress,clientId:form.clientId?+form.clientId:null,milestones:form.milestones||[],docs:form.docs||[]};if(sel)setJobs(js=>js.map(j=>j.id===sel.id?{...u,id:j.id}:j));else setJobs(js=>[...js,{...u,id:Date.now()}]);setShowM(false);}function updM(ms){const job=jobs.find(j=>j.id===detail.id);setJobs(js=>js.map(j=>j.id===detail.id?{...j,milestones:ms}:j));setDetail(d=>({...d,milestones:ms}));if(job)syncMilestoneEvents(job.id,ms,job.name);}function toggleShare(jobId){setJobs(js=>js.map(j=>j.id===jobId?{...j,sharedWithClient:!j.sharedWithClient}:j));}
if(detail){const job=jobs.find(j=>j.id===detail.id)||detail;const cl=getClient(job.clientId);const done=job.milestones.filter(m=>m.status==="Completed").length;const jobLogs=(logs||[]).filter(l=>l.jobId===job.id).sort((a,b)=>b.date.localeCompare(a.date));return <div><div style={{marginBottom:14}}><Btn variant="ghost" size="sm" onClick={()=>setDetail(null)}>‚Üê All Projects</Btn></div><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:14,flexWrap:"wrap",gap:10}}><div><h1 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:22,margin:0}}>{job.name}</h1><div style={{color:"#6B7280",marginTop:3,fontSize:12}}>{cl?.name} ¬∑ {job.address}</div></div><div style={{display:"flex",gap:7,alignItems:"center",flexWrap:"wrap"}}><Badge label={job.status}/><button onClick={()=>toggleShare(job.id)} style={{fontSize:11,padding:"4px 10px",borderRadius:20,border:`1px solid ${job.sharedWithClient?"#4ade8044":"#2E3D4F"}`,background:job.sharedWithClient?"#14532d22":"transparent",color:job.sharedWithClient?"#4ade80":"#6B7280",cursor:"pointer",fontFamily:"system-ui,-apple-system,sans-serif"}}>{job.sharedWithClient?"‚úì Shared with Client":"Share with Client"}</button><Btn size="sm" variant="ghost" onClick={()=>openEdit(job)}>Edit</Btn></div></div><div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(110px,1fr))",gap:9,marginBottom:14}}>{[{label:"Contract",value:fmt$(job.value),color:"#FFFFFF"},{label:"Received",value:fmt$(job.paid),color:"#4ade80"},{label:"Outstanding",value:fmt$(job.value-job.paid),color:"#F59E0B"},{label:"Milestones",value:`${done}/${job.milestones.length}`,color:"#C8A96A"}].map(k=>(<Card key={k.label} style={{padding:11}}><div style={{fontSize:10,color:"#6B7280",textTransform:"uppercase",marginBottom:3}}>{k.label}</div><div style={{fontFamily:"'Georgia',serif",fontSize:17,color:k.color}}>{k.value}</div></Card>))}</div><Card style={{marginBottom:12,padding:13}}><div style={{display:"flex",justifyContent:"space-between",fontSize:12,marginBottom:6}}><span style={{color:"#6B7280"}}>Overall Progress</span><span style={{color:"#C8A96A",fontWeight:700}}>{job.progress}%</span></div><div style={{background:"#2E3D4F",borderRadius:6,height:7}}><div style={{background:"#C8A96A",borderRadius:6,height:7,width:`${job.progress}%`,transition:"width 0.5s"}}/></div><div style={{display:"flex",gap:14,marginTop:7,fontSize:11,color:"#6B7280"}}><span>Start: <b style={{color:"#FFFFFF"}}>{fmtDate(job.startDate)}</b></span><span>End: <b style={{color:"#FFFFFF"}}>{fmtDate(job.endDate)}</b></span></div></Card>
<div style={{display:"flex",borderBottom:"1px solid #2E3D4F",marginBottom:14,overflowX:"auto"}}>{["milestones","gantt","costs","changes","photos","log","documents","details"].map(t=>(<button key={t} onClick={()=>setTab(t)} style={{background:"none",border:"none",padding:"8px 13px",cursor:"pointer",color:tab===t?"#C8A96A":"#6B7280",fontFamily:"system-ui,-apple-system,sans-serif",fontSize:12,fontWeight:tab===t?700:400,borderBottom:tab===t?"2px solid #C8A96A":"2px solid transparent",marginBottom:-1,textTransform:"capitalize",whiteSpace:"nowrap"}}>{t}{t==="log"&&jobLogs.length>0?` (${jobLogs.length})`:""}</button>))}</div>{tab==="milestones"&&<Card><Milestones job={job} onUpdate={updM}/></Card>}{tab==="gantt"&&<Card><Gantt jobs={[job]}/></Card>}{tab==="log"&&<div>{jobLogs.length===0?<div style={{color:"#6B7280",textAlign:"center",padding:"28px 0",fontSize:12}}>No log entries for this project yet.</div>:jobLogs.map(log=>(<Card key={log.id} style={{marginBottom:10,padding:14}}><div style={{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:7,marginBottom:8}}><div style={{fontSize:13,fontWeight:600,color:"#FFFFFF"}}>{fmtDate(log.date)}</div><div style={{display:"flex",gap:8,alignItems:"center"}}>{log.visibleToClient&&<span style={{fontSize:10,color:"#4ade80"}}>‚úì Client visible</span>}<span style={{fontSize:11,color:"#6B7280"}}>{log.weather} ¬∑ {log.crew} crew ¬∑ {log.hours}h</span></div></div><div style={{fontSize:12,color:"#6B7280",lineHeight:1.6}}>{log.notes}</div>{log.photos&&log.photos.length>0&&<div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(60px,1fr))",gap:5,marginTop:10}}>{log.photos.map(p=><div key={p.id} style={{borderRadius:5,overflow:"hidden",aspectRatio:"1"}}><img src={p.url} alt={p.name} style={{width:"100%",height:"100%",objectFit:"cover",display:"block"}}/></div>)}</div>}</Card>))}</div>}{tab==="documents"&&<Card><div style={{fontWeight:700,color:"#FFFFFF",fontSize:13,marginBottom:11}}>üìÅ Project Documents</div>{(job.docs||[]).length===0?<div style={{color:"#6B7280",textAlign:"center",padding:"14px 0",fontSize:12}}>No documents yet.</div>:(job.docs).map((doc,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:9,background:"#1F2A37",borderRadius:7,padding:"8px 11px",marginBottom:6}}><span style={{fontSize:16}}>üìÑ</span><div><div style={{color:"#FFFFFF",fontSize:12,fontWeight:600}}>{doc.name}</div><div style={{color:"#6B7280",fontSize:10}}>{doc.size} ¬∑ {fmtDate(doc.date)}</div></div></div>))}</Card>}{tab==="costs"&&<JobCosting job={job} costs={costs} setCosts={setCosts}/>}{tab==="changes"&&<ChangeOrders job={job} changeOrders={changeOrders} setChangeOrders={setChangeOrders}/>}{tab==="photos"&&<PhotoGallery job={job} logs={logs}/>}{tab==="details"&&<Card><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9,marginBottom:11}}>{[["Client",cl?.name||"‚Äî"],["Email",cl?.email||"‚Äî"],["Address",job.address],["Type",job.type],["Start",fmtDate(job.startDate)],["End",fmtDate(job.endDate)]].map(([k,v])=>(<div key={k} style={{background:"#1F2A37",borderRadius:7,padding:10}}><div style={{fontSize:10,color:"#6B7280",textTransform:"uppercase",marginBottom:2}}>{k}</div><div style={{fontSize:12,fontWeight:600,color:"#FFFFFF"}}>{v}</div></div>))}</div>{job.notes&&<div style={{color:"#6B7280",fontSize:11}}>üìù {job.notes}</div>}</Card>}{showM&&<Modal title="Edit Project" onClose={()=>setShowM(false)}><Inp label="Project Name" value={form.name||""} onChange={v=>f("name",v)}/><Sel label="Client" value={form.clientId||""} onChange={v=>f("clientId",v)} options={["",...clients.map(c=>c.id)]} display={["(No client)",...clients.map(c=>c.name)]}/><Inp label="Address" value={form.address||""} onChange={v=>f("address",v)}/><Sel label="Type" value={form.type||"Deck"} onChange={v=>f("type",v)} options={["Deck","Basement","Garage","Bathroom","Fence","Addition","Other"]}/><Sel label="Status" value={form.status||"Upcoming"} onChange={v=>f("status",v)} options={JOB_STATUSES}/><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}><Inp label="Contract Value" type="number" value={form.value||""} onChange={v=>f("value",v)}/><Inp label="Amount Received" type="number" value={form.paid||""} onChange={v=>f("paid",v)}/></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}><Inp label="Start Date" type="date" value={form.startDate||""} onChange={v=>f("startDate",v)}/><Inp label="End Date" type="date" value={form.endDate||""} onChange={v=>f("endDate",v)}/></div><div style={{marginBottom:11}}><label style={{display:"block",fontSize:11,color:"#6B7280",marginBottom:3,textTransform:"uppercase"}}>Progress ({form.progress||0}%)</label><input type="range" min={0} max={100} value={form.progress||0} onChange={e=>f("progress",e.target.value)} style={{width:"100%",accentColor:"#C8A96A"}}/></div><Inp label="Notes" value={form.notes||""} onChange={v=>f("notes",v)}/><div style={{display:"flex",gap:9,justifyContent:"flex-end",marginTop:8}}><Btn variant="ghost" onClick={()=>setShowM(false)}>Cancel</Btn><Btn onClick={save}>Save Project</Btn></div></Modal>}</div>;}
return <div><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:10}}><h1 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:26,margin:0}}>Projects</h1><Btn onClick={openNew}>+ New Project</Btn></div><div style={{display:"flex",gap:6,marginBottom:14,flexWrap:"wrap"}}>{["All",...JOB_STATUSES].map(s=><button key={s} onClick={()=>setFilter(s)} style={{padding:"4px 11px",borderRadius:20,border:`1px solid ${filter===s?"#C8A96A":"#2E3D4F"}`,background:filter===s?"#C8A96A22":"transparent",color:filter===s?"#C8A96A":"#6B7280",cursor:"pointer",fontSize:11,fontFamily:"system-ui,-apple-system,sans-serif"}}>{s}</button>)}</div><div style={{display:"grid",gap:10}}>{filtered.map(job=>{const cl=getClient(job.clientId);const done=(job.milestones||[]).filter(m=>m.status==="Completed").length;const tot=(job.milestones||[]).length;const logCount=(logs||[]).filter(l=>l.jobId===job.id).length;return <Card key={job.id} onClick={()=>setDetail(job)}><div style={{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:8}}><div><div style={{fontWeight:700,color:"#FFFFFF",fontSize:14}}>{job.name}</div><div style={{color:"#6B7280",fontSize:11}}>{cl?.name} ¬∑ {job.address}</div><div style={{color:"#6B7280",fontSize:10,marginTop:2}}>{fmtDate(job.startDate)} ‚Üí {fmtDate(job.endDate)}</div></div><div style={{textAlign:"right"}}><Badge label={job.status}/>{job.sharedWithClient&&<div style={{fontSize:9,color:"#4ade80",marginTop:4}}>‚úì Client can view</div>}<div style={{color:"#C8A96A",fontWeight:700,fontSize:15,marginTop:4}}>{fmt$(job.value)}</div><div style={{color:"#6B7280",fontSize:10}}>{tot>0?`${done}/${tot} milestones`:""}{logCount>0?` ¬∑ ${logCount} logs`:""}</div></div></div>{tot>0&&<div style={{marginTop:9}}><div style={{background:"#2E3D4F",borderRadius:4,height:4}}><div style={{background:job.progress===100?"#4ade80":"#C8A96A",borderRadius:4,height:4,width:`${job.progress}%`}}/></div></div>}</Card>;})} </div>{showM&&<Modal title="New Project" onClose={()=>setShowM(false)}><Inp label="Project Name" value={form.name||""} onChange={v=>f("name",v)}/><Sel label="Client" value={form.clientId||""} onChange={v=>f("clientId",v)} options={["",...clients.map(c=>c.id)]} display={["(No client)",...clients.map(c=>c.name)]}/><Inp label="Address" value={form.address||""} onChange={v=>f("address",v)}/><Sel label="Type" value={form.type||"Deck"} onChange={v=>f("type",v)} options={["Deck","Basement","Garage","Bathroom","Fence","Addition","Other"]}/><Sel label="Status" value={form.status||"Upcoming"} onChange={v=>f("status",v)} options={JOB_STATUSES}/><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}><Inp label="Contract Value" type="number" value={form.value||""} onChange={v=>f("value",v)}/><Inp label="Amount Received" type="number" value={form.paid||""} onChange={v=>f("paid",v)}/></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}><Inp label="Start Date" type="date" value={form.startDate||""} onChange={v=>f("startDate",v)}/><Inp label="End Date" type="date" value={form.endDate||""} onChange={v=>f("endDate",v)}/></div><Inp label="Notes" value={form.notes||""} onChange={v=>f("notes",v)}/><div style={{display:"flex",gap:9,justifyContent:"flex-end",marginTop:8}}><Btn variant="ghost" onClick={()=>setShowM(false)}>Cancel</Btn><Btn onClick={save}>Save Project</Btn></div></Modal>}</div>;}
function Schedule({events,setEvents,jobs}){const [view,setView]=useState("list");const [showM,setShowM]=useState(false);const [sel,setSel]=useState(null);const [form,setForm]=useState({});const [drag,setDrag]=useState(null);const [cal,setCal]=useState(new Date());const [pf,setPf]=useState("all");const [dayModal,setDayModal]=useState(null);const f=(k,v)=>setForm(p=>({...p,[k]:v}));const yr=cal.getFullYear(),mo=cal.getMonth();const firstDay=new Date(yr,mo,1).getDay();const dim=new Date(yr,mo+1,0).getDate();const MN=["January","February","March","April","May","June","July","August","September","October","November","December"];const fe=pf==="all"?events:pf==="none"?events.filter(e=>!e.jobId):events.filter(e=>e.jobId===+pf);const upcoming=[...fe].sort((a,b)=>a.date.localeCompare(b.date)).filter(e=>e.date>=todayStr()).slice(0,10);function openNew(){setForm({title:"",jobId:"",date:todayStr(),time:"09:00",type:"site"});setSel(null);setShowM(true);}function openEdit(ev){setForm({...ev,jobId:ev.jobId||""});setSel(ev);setShowM(true);}function save(){const ev={...form,jobId:form.jobId?+form.jobId:null};if(sel)setEvents(es=>es.map(e=>e.id===sel.id?{...ev,id:e.id}:e));else setEvents(es=>[...es,{...ev,id:Date.now()}]);setShowM(false);}function del(id){setEvents(es=>es.filter(e=>e.id!==id));}function dayEvs(d){const ds=`${yr}-${String(mo+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;return fe.filter(e=>e.date===ds);}function drop(e,d){e.preventDefault();if(!drag)return;const nd=`${yr}-${String(mo+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;setEvents(es=>es.map(ev=>ev.id===drag.id?{...ev,date:nd}:ev));setDrag(null);}
return <div><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:10}}><h1 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:26,margin:0}}>Schedule</h1><div style={{display:"flex",gap:7,alignItems:"center",flexWrap:"wrap"}}>{["list","calendar"].map(v=><button key={v} onClick={()=>setView(v)} style={{padding:"5px 11px",borderRadius:6,border:`1px solid ${view===v?"#C8A96A":"#2E3D4F"}`,background:view===v?"#C8A96A22":"transparent",color:view===v?"#C8A96A":"#6B7280",cursor:"pointer",fontSize:11,fontFamily:"system-ui,-apple-system,sans-serif",textTransform:"capitalize"}}>{v}</button>)}<Btn onClick={openNew}>+ Add Event</Btn></div></div><div style={{marginBottom:14,display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"}}><label style={{fontSize:11,color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.06em"}}>Project:</label><select value={pf} onChange={e=>setPf(e.target.value)} style={{background:"#2C3E50",border:"1px solid #2E3D4F",borderRadius:7,padding:"6px 12px",color:"#FFFFFF",fontSize:12,fontFamily:"system-ui,-apple-system,sans-serif",outline:"none",cursor:"pointer"}}><option value="all">All Projects</option><option value="none">No Project (General)</option>{jobs.map(j=><option key={j.id} value={j.id}>{j.name}</option>)}</select>{pf!=="all"&&<button onClick={()=>setPf("all")} style={{fontSize:11,color:"#6B7280",background:"none",border:"none",cursor:"pointer",textDecoration:"underline"}}>Clear</button>}</div>{view==="list"&&<div style={{display:"grid",gap:8}}>{upcoming.length===0&&<div style={{color:"#6B7280",textAlign:"center",padding:28,fontSize:12}}>No upcoming events.</div>}{upcoming.map(ev=>{const job=jobs.find(j=>j.id===ev.jobId);const color=EC[ev.type]||"#6B7280";return(<Card key={ev.id} style={{padding:11,borderLeft:`3px solid ${color}`}}><div style={{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:7}}><div><div style={{color:"#FFFFFF",fontWeight:700,fontSize:13}}>{ev.title}</div><div style={{color:"#6B7280",fontSize:11,marginTop:2}}>üìÖ {fmtDate(ev.date)} at {ev.time}{job&&<span style={{color:"#C8A96A"}}> ¬∑ {job.name}</span>}</div></div><div style={{display:"flex",gap:6,alignItems:"center"}}><span style={{fontSize:10,padding:"2px 7px",borderRadius:10,background:color+"22",color}}>{ev.type}</span><Btn size="sm" variant="ghost" onClick={()=>openEdit(ev)}>Edit</Btn><Btn size="sm" variant="danger" onClick={()=>del(ev.id)}>√ó</Btn></div></div></Card>);})}</div>}{view==="calendar"&&<Card><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}><button onClick={()=>setCal(new Date(yr,mo-1,1))} style={{background:"none",border:"1px solid #2E3D4F",color:"#6B7280",borderRadius:6,padding:"3px 10px",cursor:"pointer"}}>‚Äπ</button><span style={{color:"#FFFFFF",fontWeight:700,fontFamily:"'Georgia',serif",fontSize:15}}>{MN[mo]} {yr}</span><button onClick={()=>setCal(new Date(yr,mo+1,1))} style={{background:"none",border:"1px solid #2E3D4F",color:"#6B7280",borderRadius:6,padding:"3px 10px",cursor:"pointer"}}>‚Ä∫</button></div><div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2,marginBottom:2}}>{["Su","Mo","Tu","We","Th","Fr","Sa"].map(d=><div key={d} style={{textAlign:"center",fontSize:10,color:"#6B7280",padding:"2px 0"}}>{d}</div>)}</div><div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:2}}>{Array.from({length:firstDay}).map((_,i)=><div key={`e${i}`} style={{height:80}}/>)}{Array.from({length:dim}).map((_,i)=>{const d=i+1;const ds=`${yr}-${String(mo+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;const de=dayEvs(d);const isT=ds===todayStr();const shown=de.slice(0,2);const extra=de.length-2;return <div key={d} onDragOver={e=>e.preventDefault()} onDrop={e=>drop(e,d)} style={{height:80,background:isT?"#C8A96A22":"#1F2A37",border:`1px solid ${isT?"#C8A96A":"#2E3D4F"}`,borderRadius:5,padding:"4px 5px",overflow:"hidden",boxSizing:"border-box",cursor:de.length>0?"pointer":"default"}} onClick={de.length>2?()=>setDayModal({ds,de}):undefined}><div style={{fontSize:10,color:isT?"#C8A96A":"#6B7280",fontWeight:isT?700:400,marginBottom:3}}>{d}</div>{shown.map(ev=>(<div key={ev.id} draggable onDragStart={e=>{e.stopPropagation();setDrag(ev);}} onClick={e=>{e.stopPropagation();openEdit(ev);}} style={{fontSize:9,padding:"2px 4px",borderRadius:3,marginBottom:2,background:(EC[ev.type]||"#6B7280")+"33",color:EC[ev.type]||"#6B7280",cursor:"grab",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{ev.title}</div>))}{extra>0&&<div style={{fontSize:9,color:"#6B7280",textAlign:"right",cursor:"pointer"}} onClick={e=>{e.stopPropagation();setDayModal({ds,de});}}>+{extra} more</div>}</div>;})}</div><div style={{marginTop:7,fontSize:10,color:"#6B7280"}}>üí° Drag events to reschedule</div></Card>}{dayModal&&<Modal title={fmtDate(dayModal.ds)} onClose={()=>setDayModal(null)}><div style={{display:"grid",gap:8}}>{dayModal.de.map(ev=>{const color=EC[ev.type]||"#6B7280";const job=jobs.find(j=>j.id===ev.jobId);return(<div key={ev.id} style={{padding:"10px 12px",borderRadius:8,background:"#1F2A37",borderLeft:`3px solid ${color}`}}><div style={{color:"#FFFFFF",fontWeight:600,fontSize:13}}>{ev.title}</div><div style={{color:"#6B7280",fontSize:11,marginTop:2}}>{ev.time}{job&&<span style={{color:"#C8A96A"}}> ¬∑ {job.name}</span>}</div><div style={{marginTop:8,display:"flex",gap:7}}><Btn size="sm" variant="ghost" onClick={()=>{openEdit(ev);setDayModal(null);}}>Edit</Btn><Btn size="sm" variant="danger" onClick={()=>{del(ev.id);setDayModal(null);}}>Delete</Btn></div></div>);})}</div></Modal>}{showM&&<Modal title={sel?"Edit Event":"New Event"} onClose={()=>setShowM(false)}><Inp label="Title" value={form.title||""} onChange={v=>f("title",v)}/><Sel label="Type" value={form.type||"site"} onChange={v=>f("type",v)} options={EVENT_TYPES}/><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}><Inp label="Date" type="date" value={form.date||""} onChange={v=>f("date",v)}/><Inp label="Time" type="time" value={form.time||""} onChange={v=>f("time",v)}/></div><Sel label="Linked Project (optional)" value={form.jobId||""} onChange={v=>f("jobId",v)} options={["",...jobs.map(j=>j.id)]} display={["(None)",...jobs.map(j=>j.name)]}/><div style={{display:"flex",gap:9,justifyContent:"flex-end",marginTop:10}}>{sel&&<Btn variant="danger" onClick={()=>{del(sel.id);setShowM(false);}}>Delete</Btn>}<Btn variant="ghost" onClick={()=>setShowM(false)}>Cancel</Btn><Btn onClick={save}>Save</Btn></div></Modal>}</div>;}
function Leads({leads,setLeads}){const [showM,setShowM]=useState(false);const [sel,setSel]=useState(null);const [form,setForm]=useState({});const f=(k,v)=>setForm(p=>({...p,[k]:v}));function openNew(){setForm({name:"",phone:"",email:"",type:"Deck",value:"",stage:"New",notes:"",date:todayStr()});setSel(null);setShowM(true);}function openEdit(l){setForm({...l});setSel(l);setShowM(true);}function save(){const u={...form,value:+form.value};if(sel)setLeads(ls=>ls.map(l=>l.id===sel.id?{...u,id:l.id}:l));else setLeads(ls=>[...ls,{...u,id:Date.now()}]);setShowM(false);}const byStage=LEAD_STAGES.reduce((acc,s)=>({...acc,[s]:leads.filter(l=>l.stage===s)}),{});return <div><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h1 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:26,margin:0}}>Pipeline</h1><Btn onClick={openNew}>+ New Lead</Btn></div><div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(140px,1fr))",gap:10}}>{LEAD_STAGES.map(stage=><div key={stage}><div style={{fontSize:10,color:"#6B7280",textTransform:"uppercase",marginBottom:7,fontWeight:700,letterSpacing:"0.06em"}}>{stage} <span style={{color:"#C8A96A"}}>({byStage[stage].length})</span></div>{byStage[stage].map(l=><Card key={l.id} onClick={()=>openEdit(l)} style={{marginBottom:7,padding:11}}><div style={{fontWeight:700,color:"#FFFFFF",fontSize:13,marginBottom:3}}>{l.name}</div><div style={{fontSize:11,color:"#6B7280",marginBottom:4}}>{l.type}</div><div style={{color:"#C8A96A",fontWeight:700,fontSize:12}}>{fmt$(l.value)}</div>{l.notes&&<div style={{fontSize:10,color:"#6B7280",marginTop:4}}>{l.notes}</div>}</Card>)}</div>)}</div>{showM&&<Modal title={sel?"Edit Lead":"New Lead"} onClose={()=>setShowM(false)}><Inp label="Name" value={form.name||""} onChange={v=>f("name",v)}/><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}><Inp label="Phone" value={form.phone||""} onChange={v=>f("phone",v)}/><Inp label="Email" value={form.email||""} onChange={v=>f("email",v)} type="email"/></div><Sel label="Type" value={form.type||"Deck"} onChange={v=>f("type",v)} options={["Deck","Basement","Garage","Bathroom","Fence","Addition","Other"]}/><Inp label="Estimated Value" type="number" value={form.value||""} onChange={v=>f("value",v)}/><Sel label="Stage" value={form.stage||"New"} onChange={v=>f("stage",v)} options={LEAD_STAGES}/><Inp label="Notes" value={form.notes||""} onChange={v=>f("notes",v)}/><div style={{display:"flex",gap:9,justifyContent:"flex-end",marginTop:10}}>{sel&&<Btn variant="danger" onClick={()=>{setLeads(ls=>ls.filter(l=>l.id!==sel.id));setShowM(false);}}>Delete</Btn>}<Btn variant="ghost" onClick={()=>setShowM(false)}>Cancel</Btn><Btn onClick={save}>Save</Btn></div></Modal>}</div>;}
function Subs({subs,setSubs}){const [showM,setShowM]=useState(false);const [sel,setSel]=useState(null);const [form,setForm]=useState({});const f=(k,v)=>setForm(p=>({...p,[k]:v}));function openNew(){setForm({name:"",trade:"",phone:"",email:"",rating:5,notes:"",active:true});setSel(null);setShowM(true);}function openEdit(s){setForm({...s});setSel(s);setShowM(true);}function save(){const u={...form,rating:+form.rating};if(sel)setSubs(ss=>ss.map(s=>s.id===sel.id?{...u,id:s.id}:s));else setSubs(ss=>[...ss,{...u,id:Date.now()}]);setShowM(false);}return <div><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><h1 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:26,margin:0}}>Subtrades</h1><Btn onClick={openNew}>+ Add Sub</Btn></div><div style={{display:"grid",gap:9}}>{subs.map(s=><Card key={s.id} onClick={()=>openEdit(s)}><div style={{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:7}}><div><div style={{fontWeight:700,color:"#FFFFFF",fontSize:14}}>{s.name}</div><div style={{color:"#6B7280",fontSize:12}}>{s.trade}</div><div style={{fontSize:11,color:"#6B7280",marginTop:3}}>{s.phone} ¬∑ {s.email}</div></div><div style={{textAlign:"right"}}><div style={{fontSize:15}}>{"‚≠ê".repeat(s.rating)}</div><span style={{fontSize:10,padding:"2px 7px",borderRadius:10,background:s.active?"#14532d22":"#1c1c1c",color:s.active?"#4ade80":"#6B7280"}}>{s.active?"Active":"Inactive"}</span></div></div>{s.notes&&<div style={{fontSize:11,color:"#6B7280",marginTop:6}}>üìù {s.notes}</div>}</Card>)}</div>{showM&&<Modal title={sel?"Edit Subtrade":"Add Subtrade"} onClose={()=>setShowM(false)}><Inp label="Name" value={form.name||""} onChange={v=>f("name",v)}/><Inp label="Trade" value={form.trade||""} onChange={v=>f("trade",v)}/><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:9}}><Inp label="Phone" value={form.phone||""} onChange={v=>f("phone",v)}/><Inp label="Email" value={form.email||""} onChange={v=>f("email",v)}/></div><div style={{marginBottom:11}}><label style={{display:"block",fontSize:11,color:"#6B7280",marginBottom:3,textTransform:"uppercase"}}>Rating ({form.rating}/5)</label><input type="range" min={1} max={5} value={form.rating||5} onChange={e=>f("rating",e.target.value)} style={{width:"100%",accentColor:"#C8A96A"}}/></div><Inp label="Notes" value={form.notes||""} onChange={v=>f("notes",v)}/><div style={{marginBottom:11}}><label style={{display:"flex",alignItems:"center",gap:7,cursor:"pointer"}}><input type="checkbox" checked={form.active??true} onChange={e=>f("active",e.target.checked)} style={{accentColor:"#C8A96A"}}/><span style={{color:"#6B7280",fontSize:12}}>Active</span></label></div><div style={{display:"flex",gap:9,justifyContent:"flex-end",marginTop:8}}>{sel&&<Btn variant="danger" onClick={()=>{setSubs(ss=>ss.filter(s=>s.id!==sel.id));setShowM(false);}}>Delete</Btn>}<Btn variant="ghost" onClick={()=>setShowM(false)}>Cancel</Btn><Btn onClick={save}>Save</Btn></div></Modal>}</div>;}
function ClientPortal({jobs,clients,logs}){const [email,setEmail]=useState("priya@example.com");const [sub,setSub]=useState(false);const [selId,setSelId]=useState(null);const [err,setErr]=useState("");const clientObj=clients.find(c=>c.email===email);const clientJobs=clientObj?jobs.filter(j=>j.clientId===clientObj.id&&j.sharedWithClient):[];const job=clientJobs.find(j=>j.id===selId)||clientJobs[0];const jobLogs=job?(logs||[]).filter(l=>l.jobId===job.id&&l.visibleToClient).sort((a,b)=>b.date.localeCompare(a.date)):[];function tryLogin(){setErr("");if(!clientObj){setErr("No client account found for this email.");return;}if(clientJobs.length===0){setErr("No projects have been shared with this account yet.");return;}setSub(true);}if(!sub)return <div><h1 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:26,marginBottom:4}}>Client Portal Preview</h1><p style={{color:"#6B7280",marginBottom:20,fontSize:13}}>Only projects marked "Share with Client" are visible. Try <b style={{color:"#C8A96A"}}>priya@example.com</b> or <b style={{color:"#C8A96A"}}>dave@example.com</b></p><Card style={{maxWidth:380,marginBottom:14}}><Inp label="Client Email" value={email} onChange={v=>{setEmail(v);setErr("");}} type="email" placeholder="client@example.com"/>{err&&<div style={{color:"#EF4444",fontSize:12,marginBottom:10,padding:"7px 10px",background:"#EF444422",borderRadius:6,borderLeft:"3px solid #EF4444"}}>{err}</div>}<Btn onClick={tryLogin}>View Portal</Btn></Card><div style={{padding:14,background:"#2C3E50",borderRadius:8,border:"1px solid #2E3D4F",maxWidth:380}}><div style={{fontSize:11,color:"#6B7280",textTransform:"uppercase",marginBottom:8,letterSpacing:"0.06em"}}>Access Control</div>{jobs.map(j=>{const cl=clients.find(c=>c.id===j.clientId);return(<div key={j.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 0",borderBottom:"1px solid #2E3D4F",fontSize:12}}><span style={{color:"#FFFFFF"}}>{j.name}</span><div style={{display:"flex",alignItems:"center",gap:7}}><span style={{color:"#6B7280",fontSize:10}}>{cl?.name}</span><span style={{fontSize:10,padding:"1px 7px",borderRadius:10,background:j.sharedWithClient?"#14532d22":"#1c1c1c",color:j.sharedWithClient?"#4ade80":"#6B7280"}}>{j.sharedWithClient?"Shared":"Hidden"}</span></div></div>);})}</div></div>;
return <div><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}><h1 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:26,margin:0}}>Client Portal Preview</h1><Btn size="sm" variant="ghost" onClick={()=>setSub(false)}>‚Üê Change Email</Btn></div><p style={{color:"#6B7280",marginBottom:14,fontSize:12}}>Portal for: <b style={{color:"#C8A96A"}}>{email}</b> ‚Äî {clientJobs.length} project{clientJobs.length!==1?"s":""} shared</p>{clientJobs.length>1&&<div style={{display:"flex",gap:6,marginBottom:14,flexWrap:"wrap"}}>{clientJobs.map(j=><button key={j.id} onClick={()=>setSelId(j.id)} style={{padding:"5px 13px",borderRadius:20,border:`1px solid ${job?.id===j.id?"#C8A96A":"#2E3D4F"}`,background:job?.id===j.id?"#C8A96A22":"transparent",color:job?.id===j.id?"#C8A96A":"#6B7280",cursor:"pointer",fontFamily:"system-ui,-apple-system,sans-serif",fontSize:12}}>{j.name}</button>)}</div>}{job&&<div><Card style={{marginBottom:11}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:8,marginBottom:12}}><div><div style={{fontFamily:"'Georgia',serif",fontSize:19,color:"#FFFFFF"}}>{job.name}</div><div style={{color:"#6B7280",fontSize:12}}>{job.address}</div></div><Badge label={job.status}/></div><div style={{display:"flex",justifyContent:"space-between",fontSize:11,color:"#6B7280",marginBottom:4}}><span>Overall Progress</span><span style={{color:"#C8A96A"}}>{job.progress}% Complete</span></div><div style={{background:"#2E3D4F",borderRadius:6,height:7}}><div style={{background:"#C8A96A",borderRadius:6,height:7,width:`${job.progress}%`,transition:"width 0.5s"}}/></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:7,marginTop:11}}><div style={{background:"#1F2A37",borderRadius:7,padding:11}}><div style={{fontSize:10,color:"#6B7280",marginBottom:2}}>Start Date</div><div style={{color:"#FFFFFF",fontWeight:600,fontSize:12}}>{fmtDate(job.startDate)}</div></div><div style={{background:"#1F2A37",borderRadius:7,padding:11}}><div style={{fontSize:10,color:"#6B7280",marginBottom:2}}>Est. Completion</div><div style={{color:"#FFFFFF",fontWeight:600,fontSize:12}}>{fmtDate(job.endDate)}</div></div></div></Card><Card style={{marginBottom:11}}><div style={{fontWeight:700,color:"#FFFFFF",marginBottom:11,fontSize:13}}>üéØ Project Milestones</div>{(job.milestones||[]).map((m,i)=>{const done=m.status==="Completed";const act=m.status==="In Progress";return(<div key={m.id} style={{display:"flex",alignItems:"center",gap:9,padding:"7px 0",borderBottom:i<job.milestones.length-1?"1px solid #2E3D4F":"none"}}><div style={{width:22,height:22,borderRadius:"50%",background:done?"#4ade8033":act?"#C8A96A33":"#2E3D4F",border:`2px solid ${done?"#4ade80":act?"#C8A96A":"#6B7280"}`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,fontSize:11}}>{done?"‚úì":act?"‚óè":i+1}</div><div style={{flex:1}}><div style={{color:done?"#6B7280":"#FFFFFF",fontSize:12,fontWeight:600,textDecoration:done?"line-through":"none"}}>{m.name}</div>{m.date&&<div style={{fontSize:10,color:"#6B7280"}}>{fmtDate(m.date)}</div>}</div><Badge label={m.status}/></div>);})} </Card>{jobLogs.length>0&&<Card style={{marginBottom:11}}><div style={{fontWeight:700,color:"#FFFFFF",marginBottom:11,fontSize:13}}>üìã Site Updates</div>{jobLogs.map((log,i)=>(<div key={log.id} style={{paddingBottom:14,marginBottom:i<jobLogs.length-1?14:0,borderBottom:i<jobLogs.length-1?"1px solid #2E3D4F":"none"}}><div style={{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:6,marginBottom:6}}><div style={{fontSize:12,fontWeight:600,color:"#FFFFFF"}}>{fmtDate(log.date)}</div><div style={{fontSize:11,color:"#6B7280"}}>{log.weather} ¬∑ {log.crew} crew ¬∑ {log.hours}h</div></div><div style={{fontSize:12,color:"#6B7280",lineHeight:1.6,marginBottom:log.photos&&log.photos.length>0?10:0}}>{log.notes}</div>{log.photos&&log.photos.length>0&&(<div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(70px,1fr))",gap:5}}>{log.photos.map(p=><div key={p.id} style={{borderRadius:5,overflow:"hidden",aspectRatio:"1"}}><img src={p.url} alt={p.name} style={{width:"100%",height:"100%",objectFit:"cover",display:"block"}}/></div>)}</div>)}</div>))}</Card>}</div>}</div>;}
const NAV=[{id:"dashboard",label:"Dashboard",icon:"‚óà"},{id:"clients",label:"Clients",icon:"üë§"},{id:"jobs",label:"Projects",icon:"üèó"},{id:"gantt",label:"Gantt",icon:"üìä"},{id:"logs",label:"Daily Log",icon:"üìã"},{id:"leads",label:"Pipeline",icon:"üéØ"},{id:"schedule",label:"Schedule",icon:"üìÖ"},{id:"subs",label:"Subtrades",icon:"üë∑"},{id:"client",label:"Client Portal",icon:"üëÅ"}];
function App(){const [page,setPage]=useState("dashboard");const [navOpen,setNavOpen]=useState(false);const [clients,setClients]=useState(initClients);const [jobs,setJobs]=useState(initJobs);const [leads,setLeads]=useState(initLeads);const [subs,setSubs]=useState(initSubs);const [events,setEvents]=useState(initEvents);const [logs,setLogs]=useState(initLogs);const [changeOrders,setChangeOrders]=useState(initChangeOrders);const [costs,setCosts]=useState(initCosts);const navRef=useRef(null);
useEffect(()=>{function handle(e){if(navOpen&&navRef.current&&!navRef.current.contains(e.target))setNavOpen(false);}document.addEventListener("mousedown",handle);return()=>document.removeEventListener("mousedown",handle);},[navOpen]);
const enrichedJobs=jobs.map(j=>({...j,_clientName:clients.find(c=>c.id===j.clientId)?.name||""}));function navigate(id){setPage(id);setNavOpen(false);}
const render=()=>{switch(page){case"dashboard":return <Dashboard jobs={enrichedJobs} leads={leads} clients={clients} logs={logs} setPage={setPage}/>;case"clients":return <Clients clients={clients} setClients={setClients} jobs={jobs}/>;case"jobs":return <Jobs jobs={jobs} setJobs={setJobs} clients={clients} logs={logs} changeOrders={changeOrders} setChangeOrders={setChangeOrders} costs={costs} setCosts={setCosts} events={events} setEvents={setEvents}/>;case"gantt":return <div><h1 style={{fontFamily:"'Georgia',serif",color:"#FFFFFF",fontSize:26,marginBottom:4}}>Gantt Chart</h1><p style={{color:"#6B7280",marginBottom:14,fontSize:12}}>All active & upcoming projects. Diamonds = milestones.</p><Card><Gantt jobs={enrichedJobs}/></Card></div>;case"logs":return <DailyLog logs={logs} setLogs={setLogs} jobs={jobs} clients={clients}/>;case"leads":return <Leads leads={leads} setLeads={setLeads}/>;case"schedule":return <Schedule events={events} setEvents={setEvents} jobs={jobs}/>;case"subs":return <Subs subs={subs} setSubs={setSubs}/>;case"client":return <ClientPortal jobs={jobs} clients={clients} logs={logs}/>;default:return null;}};
return <div style={{display:"flex",minHeight:"100vh",background:"#1F2A37",fontFamily:"system-ui,-apple-system,sans-serif",color:"#FFFFFF",position:"relative"}}>{navOpen&&<div onClick={()=>setNavOpen(false)} style={{position:"fixed",inset:0,background:"#00000060",zIndex:999}}/>}<div ref={navRef} style={{position:"fixed",top:0,left:0,bottom:0,width:200,background:"#16212E",borderRight:"1px solid #2E3D4F",display:"flex",flexDirection:"column",zIndex:1000,transform:navOpen?"translateX(0)":"translateX(-100%)",transition:"transform 0.25s ease"}}><div style={{padding:"10px 14px",borderBottom:"1px solid #2E3D4F",display:"flex",justifyContent:"space-between",alignItems:"center"}}><img src={LOGO} alt="Tall Guy Builds Inc." style={{width:80,height:80,objectFit:"contain"}}/><button onClick={()=>setNavOpen(false)} style={{background:"none",border:"none",color:"#6B7280",fontSize:22,cursor:"pointer",lineHeight:1,padding:0}}>√ó</button></div><nav style={{flex:1,padding:"7px 6px",overflowY:"auto"}}>{NAV.map(n=><button key={n.id} onClick={()=>navigate(n.id)} style={{display:"flex",alignItems:"center",gap:9,width:"100%",padding:"8px 9px",borderRadius:7,border:"none",background:page===n.id?"#C8A96A20":"transparent",color:page===n.id?"#C8A96A":"#6B7280",cursor:"pointer",fontFamily:"system-ui,-apple-system,sans-serif",fontSize:12,fontWeight:page===n.id?700:400,marginBottom:1,textAlign:"left"}}><span style={{fontSize:14}}>{n.icon}</span>{n.label}</button>)}</nav><div style={{padding:"10px 14px",borderTop:"1px solid #2E3D4F",fontSize:9,color:"#6B7280"}}>Built Right. Designed to Last.</div></div><div style={{flex:1,display:"flex",flexDirection:"column",minWidth:0}}><div style={{position:"sticky",top:0,zIndex:100,background:"#16212E",borderBottom:"1px solid #2E3D4F",padding:"8px 16px",display:"flex",alignItems:"center",gap:12}}><button onClick={()=>setNavOpen(o=>!o)} style={{background:"none",border:"1px solid #2E3D4F",borderRadius:7,padding:"6px 9px",cursor:"pointer",display:"flex",flexDirection:"column",gap:4}}><div style={{width:18,height:2,background:"#FFFFFF",borderRadius:2}}/><div style={{width:18,height:2,background:"#FFFFFF",borderRadius:2}}/><div style={{width:18,height:2,background:"#FFFFFF",borderRadius:2}}/></button><img src={LOGO} alt="Tall Guy Builds" style={{height:38,objectFit:"contain"}}/><div style={{flex:1}}/><div style={{fontSize:11,color:"#6B7280",fontFamily:"'Georgia',serif"}}>{NAV.find(n=>n.id===page)?.label||""}</div></div><div style={{flex:1,overflow:"auto"}}><div style={{maxWidth:900,margin:"0 auto",padding:"20px 16px"}}>{render()}</div></div></div></div>;}
const root=ReactDOM.createRoot(document.getElementById("root"));
root.render(React.createElement(App));
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js');
      });
    }
    var isIOS = /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
    var isStandalone = window.navigator.standalone === true;
    var dismissed = localStorage.getItem('tgb_install_dismissed');
    if (isIOS && !isStandalone && !dismissed) {
      var banner = document.createElement('div');
      banner.style.cssText = 'position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#1F2A37;color:#C8A96A;padding:12px 18px;border-radius:12px;font-family:system-ui;font-size:13px;z-index:9999;border:1px solid #C8A96A44;box-shadow:0 4px 24px #000a;max-width:300px;text-align:center;';
      banner.innerHTML = '<strong>Install this app</strong><br><span style="color:#9ca3af;font-size:11px;">Tap Share then Add to Home Screen</span><br><button id="tgb-dismiss" style="margin-top:8px;background:transparent;border:1px solid #C8A96A44;color:#9ca3af;padding:4px 14px;border-radius:20px;cursor:pointer;font-size:11px;">Dismiss</button>';
      document.body.appendChild(banner);
      document.getElementById('tgb-dismiss').addEventListener('click', function() {
        banner.remove();
        localStorage.setItem('tgb_install_dismissed', '1');
      });
    }
  </script>
</body>
</html>
